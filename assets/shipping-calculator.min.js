(()=>{var o=class extends HTMLElement{constructor(){super();this.url=this.dataset.url,this.form=this.querySelector("form"),this.country=this.querySelector("[name*=country]"),this.province=this.querySelector("[name*=province]"),this.zip=this.querySelector("[name*=zip]"),this.country.addEventListener("change",this.countryChange.bind(this)),this.form.addEventListener("submit",this.onSubmit.bind(this))}countryChange(){let e=JSON.parse(this.country.options[this.country.selectedIndex].dataset.provinces);this.province.innerHTML="",e.length?(e.forEach(t=>{let n=document.createElement("option");n.value=t[0],n.textContent=t[1],this.province.insertAdjacentElement("beforeend",n)}),this.province.closest(".form-field").style.display=null):this.province.closest(".form-field").style.display="none"}onSubmit(e){e.preventDefault(),this.classList.add("calculating");let t=new FormData(this.form),n=new URLSearchParams(t).toString();fetch(this.url+"?"+n).then(i=>i.json()).then(i=>{console.log(i),this.renderResult(i)}).finally(()=>{this.classList.remove("calculating")})}renderResult(e){let t=theme.shippingString.not_found_shipping_rate;e.shipping_rates&&e.shipping_rates.length>1?t=theme.shippingString.many_shipping_rates.replace("{{number}}",e.shipping_rates.length):e.shipping_rates&&e.shipping_rates.length==1&&(t=theme.shippingString.one_shipping_rate),this.querySelector(".js-response-title").innerHTML=t;let n=this.querySelector(".js-shipping-result"),i=this.querySelector("template").content.firstElementChild,s=document.createElement("div");n.innerHTML="",e.shipping_rates&&e.shipping_rates.forEach(r=>{s.innerHTML=i.outerHTML,s.querySelector(".shipping-name").innerHTML=r.name,s.querySelector("price-item").set(r.price),n.insertAdjacentHTML("beforeend",s.innerHTML)})}};customElements.define("shipping-calculator",o);})();
