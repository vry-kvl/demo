(()=>{var h=class extends HTMLElement{constructor(){super();this.form=this.querySelector("form"),this.input=this.querySelector("[name=q]"),this.searchQuery=JSON.parse(theme.serializeForm(this.form)),this.searchQuery.view="suggest",this.searchQuery.section_id="main-search",this.searchRecommend=JSON.parse(this.querySelector("script[type*=json]")?.innerHTML||"[]"),this.attachEvents()}attachEvents(){this.addEventListener("input",theme.debounce(s=>{this.onChange(s)},300).bind(this)),this.input.addEventListener("focus",this.onFocus.bind(this)),this.addEventListener("focusout",this.onFocusOut.bind(this)),this.addEventListener("keyup",this.onKeyup.bind(this))}onChange(s){let e=s.target.value.trim();if(!e.length){this.close();return}this.classList.add("is-searching");let t=this.searchRecommend.length?this.recommend(e):"";this.getRequest(e,t)}open(){this.classList.add("show")}close(){this.classList.remove("show")}onFocus(){this.open()}onFocusOut(){setTimeout(()=>{this.contains(document.activeElement)||this.close()})}onKeyup(s){s.code=="Escape"&&this.close()}getRequest(s,e){this.searchQuery.q=s,e.length&&(this.searchQuery.recommend=e);let t=new URLSearchParams(this.searchQuery).toString(),r=this.form.action+"?"+t;fetch(r).then(i=>i.text()).then(i=>{let n=document.createElement("div");n.innerHTML=i,this.querySelector(".js-search-result").innerHTML=n.querySelector(".shopify-section").innerHTML,this.querySelector(".js-search-result .js-search-submit")?.addEventListener("click",o=>{this.form.submit()}),this.classList.remove("is-searching"),this.open()})}recommend(s){let e=[];return this.searchRecommend.every(t=>{let r=this.countOcurrences(t,s);return r>0&&e.push({count:r,str:t}),!(e.length>=5)}),e.length?(e.sort((t,r)=>r.count-t.count),e.map(t=>t.str).join(", ")):""}countOcurrences(s,e){var t=new RegExp(e,"gi");return(s.match(t)||[]).length}};customElements.define("predictive-search",h);})();
