{
  "version": 3,
  "sources": ["../../app/scripts/shipping-calculator.js"],
  "sourcesContent": ["class ShippingCalculator extends HTMLElement {\r\n  constructor() {\r\n    super();\r\n\r\n    this.url = this.dataset.url;\r\n    this.form = this.querySelector('form');\r\n    this.country = this.querySelector('[name*=country]');\r\n    this.province = this.querySelector('[name*=province]');\r\n    this.zip = this.querySelector('[name*=zip]');\r\n\r\n    this.country.addEventListener('change', this.countryChange.bind(this));\r\n\r\n    this.form.addEventListener('submit', this.onSubmit.bind(this));\r\n  }\r\n\r\n  countryChange(){\r\n    const province = JSON.parse(this.country.options[this.country.selectedIndex].dataset.provinces);\r\n\r\n    this.province.innerHTML = '';\r\n\r\n    if(province.length){\r\n      province.forEach(item=>{\r\n        const option = document.createElement('option');\r\n        option.value = item[0];\r\n        option.textContent = item[1];\r\n        this.province.insertAdjacentElement('beforeend', option);\r\n      });\r\n\r\n      this.province.closest('.form-field').style.display = null;\r\n    }else{\r\n      this.province.closest('.form-field').style.display = 'none';\r\n    }\r\n  }\r\n\r\n  onSubmit(e){\r\n    e.preventDefault();\r\n    this.classList.add('calculating');\r\n    let formData = new FormData(this.form);\r\n    let searchParams = new URLSearchParams(formData).toString();\r\n\r\n    fetch(this.url + '?' + searchParams).then(e=>e.json()).then(e=>{\r\n      console.log(e);\r\n      this.renderResult(e);\r\n    })\r\n    .finally(()=>{\r\n      this.classList.remove('calculating');\r\n    })\r\n  }\r\n\r\n  renderResult(e){\r\n    let shippingTitle = theme.shippingString.not_found_shipping_rate;\r\n    if(e.shipping_rates && e.shipping_rates.length > 1){\r\n      shippingTitle = theme.shippingString.many_shipping_rates.replace('{{number}}', e.shipping_rates.length);\r\n    }\r\n    else if(e.shipping_rates && e.shipping_rates.length == 1){\r\n      shippingTitle = theme.shippingString.one_shipping_rate;\r\n    }\r\n    this.querySelector('.js-response-title').innerHTML = shippingTitle;\r\n\r\n    const resultWrapper = this.querySelector('.js-shipping-result');\r\n    const template = this.querySelector('template').content.firstElementChild;\r\n    const div = document.createElement('div');\r\n\r\n    resultWrapper.innerHTML = '';\r\n\r\n    e.shipping_rates && e.shipping_rates.forEach(item=>{      \r\n      div.innerHTML = template.outerHTML;\r\n      div.querySelector('.shipping-name').innerHTML = item.name;\r\n      div.querySelector('price-item').set(item.price);\r\n      resultWrapper.insertAdjacentHTML('beforeend', div.innerHTML);\r\n    })\r\n\r\n  }\r\n}\r\n\r\ncustomElements.define('shipping-calculator', ShippingCalculator);\r\n"],
  "mappings": "MAAA,mBAAiC,YAAY,CAC3C,aAAc,CACZ,QAEA,KAAK,IAAM,KAAK,QAAQ,IACxB,KAAK,KAAO,KAAK,cAAc,QAC/B,KAAK,QAAU,KAAK,cAAc,mBAClC,KAAK,SAAW,KAAK,cAAc,oBACnC,KAAK,IAAM,KAAK,cAAc,eAE9B,KAAK,QAAQ,iBAAiB,SAAU,KAAK,cAAc,KAAK,OAEhE,KAAK,KAAK,iBAAiB,SAAU,KAAK,SAAS,KAAK,OAG1D,eAAe,CACb,GAAM,GAAW,KAAK,MAAM,KAAK,QAAQ,QAAQ,KAAK,QAAQ,eAAe,QAAQ,WAErF,KAAK,SAAS,UAAY,GAE1B,AAAG,EAAS,OACV,GAAS,QAAQ,GAAM,CACrB,GAAM,GAAS,SAAS,cAAc,UACtC,EAAO,MAAQ,EAAK,GACpB,EAAO,YAAc,EAAK,GAC1B,KAAK,SAAS,sBAAsB,YAAa,KAGnD,KAAK,SAAS,QAAQ,eAAe,MAAM,QAAU,MAErD,KAAK,SAAS,QAAQ,eAAe,MAAM,QAAU,OAIzD,SAAS,EAAE,CACT,EAAE,iBACF,KAAK,UAAU,IAAI,eACnB,GAAI,GAAW,GAAI,UAAS,KAAK,MAC7B,EAAe,GAAI,iBAAgB,GAAU,WAEjD,MAAM,KAAK,IAAM,IAAM,GAAc,KAAK,GAAG,EAAE,QAAQ,KAAK,GAAG,CAC7D,QAAQ,IAAI,GACZ,KAAK,aAAa,KAEnB,QAAQ,IAAI,CACX,KAAK,UAAU,OAAO,iBAI1B,aAAa,EAAE,CACb,GAAI,GAAgB,MAAM,eAAe,wBACzC,AAAG,EAAE,gBAAkB,EAAE,eAAe,OAAS,EAC/C,EAAgB,MAAM,eAAe,oBAAoB,QAAQ,aAAc,EAAE,eAAe,QAE1F,EAAE,gBAAkB,EAAE,eAAe,QAAU,GACrD,GAAgB,MAAM,eAAe,mBAEvC,KAAK,cAAc,sBAAsB,UAAY,EAErD,GAAM,GAAgB,KAAK,cAAc,uBACnC,EAAW,KAAK,cAAc,YAAY,QAAQ,kBAClD,EAAM,SAAS,cAAc,OAEnC,EAAc,UAAY,GAE1B,EAAE,gBAAkB,EAAE,eAAe,QAAQ,GAAM,CACjD,EAAI,UAAY,EAAS,UACzB,EAAI,cAAc,kBAAkB,UAAY,EAAK,KACrD,EAAI,cAAc,cAAc,IAAI,EAAK,OACzC,EAAc,mBAAmB,YAAa,EAAI,eAMxD,eAAe,OAAO,sBAAuB",
  "names": []
}
