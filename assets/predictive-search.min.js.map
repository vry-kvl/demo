{
  "version": 3,
  "sources": ["../../app/scripts/predictive-search.js"],
  "sourcesContent": ["class PredictiveSearch extends HTMLElement {\r\n  constructor() {\r\n    super();\r\n    this.form = this.querySelector('form');\r\n    this.input = this.querySelector('[name=q]');\r\n    this.searchQuery = JSON.parse(theme.serializeForm(this.form));\r\n    this.searchQuery.view = 'suggest';\r\n    this.searchQuery.section_id = 'main-search';\r\n\r\n    this.searchRecommend = JSON.parse(this.querySelector('script[type*=json]')?.innerHTML || '[]');\r\n    this.attachEvents()\r\n\r\n  }\r\n\r\n\r\n  attachEvents(){\r\n    this.addEventListener('input', theme.debounce((event)=>{\r\n      this.onChange(event);\r\n    }, 300).bind(this))\r\n\r\n\r\n    this.input.addEventListener('focus', this.onFocus.bind(this));\r\n    this.addEventListener('focusout', this.onFocusOut.bind(this));\r\n    this.addEventListener('keyup', this.onKeyup.bind(this));\r\n  }\r\n\r\n  onChange(e){\r\n  \tconst key = e.target.value.trim();\r\n\r\n    if(!key.length){\r\n      this.close();\r\n      return;\r\n    }\r\n    this.classList.add('is-searching');\r\n    const recommend = this.searchRecommend.length ? this.recommend(key) : '';\r\n    this.getRequest(key, recommend);\r\n  }\r\n\r\n\r\n  open(){\r\n    this.classList.add('show');\r\n  }\r\n\r\n  close(){\r\n    this.classList.remove('show');\r\n  }\r\n\r\n  onFocus() {\r\n    this.open();\r\n  }\r\n\r\n  onFocusOut() {\r\n    setTimeout(()=>{\r\n      if (!this.contains(document.activeElement)) this.close();\r\n    })\r\n  }\r\n\r\n  onKeyup(event) {\r\n    if(event.code == 'Escape') this.close();\r\n  }\r\n\r\n  getRequest(key, recommend){\r\n    this.searchQuery.q = key;\r\n\r\n    recommend.length && (this.searchQuery.recommend = recommend);\r\n\r\n    const query = new URLSearchParams(this.searchQuery).toString();\r\n    const url = this.form.action + '?' + query\r\n\r\n    fetch(url).then(e=>e.text()).then(html=>{\r\n      let div = document.createElement('div');\r\n      div.innerHTML = html;\r\n\r\n      this.querySelector('.js-search-result').innerHTML = div.querySelector('.shopify-section').innerHTML;\r\n\r\n      this.querySelector('.js-search-result .js-search-submit')?.addEventListener('click', e=>{\r\n        this.form.submit();\r\n      });\r\n\r\n      this.classList.remove('is-searching');      \r\n      this.open();\r\n    })\r\n  }\r\n\r\n  recommend(value){\r\n    const arrayCounter = [];\r\n\r\n    this.searchRecommend.every(string=>{\r\n      let count = this.countOcurrences(string, value);\r\n      count > 0 && arrayCounter.push({count: count, str: string});\r\n\r\n      if(arrayCounter.length >= 5)\r\n        return false;\r\n      else\r\n        return true;\r\n    })\r\n\r\n    if(!arrayCounter.length){\r\n      return '';\r\n    }\r\n\r\n    arrayCounter.sort((a,b)=>{return b.count - a.count});\r\n\r\n    return arrayCounter.map(i=>i.str).join(', ')\r\n  }\r\n\r\n  countOcurrences(str, value) {\r\n    var regExp = new RegExp(value, \"gi\");\r\n    return (str.match(regExp) || []).length;\r\n  }\r\n}\r\n\r\ncustomElements.define('predictive-search', PredictiveSearch);\r\n"],
  "mappings": "MAAA,mBAA+B,YAAY,CACzC,aAAc,CACZ,QACA,KAAK,KAAO,KAAK,cAAc,QAC/B,KAAK,MAAQ,KAAK,cAAc,YAChC,KAAK,YAAc,KAAK,MAAM,MAAM,cAAc,KAAK,OACvD,KAAK,YAAY,KAAO,UACxB,KAAK,YAAY,WAAa,cAE9B,KAAK,gBAAkB,KAAK,MAAM,KAAK,cAAc,uBAAuB,WAAa,MACzF,KAAK,eAKP,cAAc,CACZ,KAAK,iBAAiB,QAAS,MAAM,SAAS,AAAC,GAAQ,CACrD,KAAK,SAAS,IACb,KAAK,KAAK,OAGb,KAAK,MAAM,iBAAiB,QAAS,KAAK,QAAQ,KAAK,OACvD,KAAK,iBAAiB,WAAY,KAAK,WAAW,KAAK,OACvD,KAAK,iBAAiB,QAAS,KAAK,QAAQ,KAAK,OAGnD,SAAS,EAAE,CACV,GAAM,GAAM,EAAE,OAAO,MAAM,OAE1B,GAAG,CAAC,EAAI,OAAO,CACb,KAAK,QACL,OAEF,KAAK,UAAU,IAAI,gBACnB,GAAM,GAAY,KAAK,gBAAgB,OAAS,KAAK,UAAU,GAAO,GACtE,KAAK,WAAW,EAAK,GAIvB,MAAM,CACJ,KAAK,UAAU,IAAI,QAGrB,OAAO,CACL,KAAK,UAAU,OAAO,QAGxB,SAAU,CACR,KAAK,OAGP,YAAa,CACX,WAAW,IAAI,CACb,AAAK,KAAK,SAAS,SAAS,gBAAgB,KAAK,UAIrD,QAAQ,EAAO,CACb,AAAG,EAAM,MAAQ,UAAU,KAAK,QAGlC,WAAW,EAAK,EAAU,CACxB,KAAK,YAAY,EAAI,EAErB,EAAU,QAAW,MAAK,YAAY,UAAY,GAElD,GAAM,GAAQ,GAAI,iBAAgB,KAAK,aAAa,WAC9C,EAAM,KAAK,KAAK,OAAS,IAAM,EAErC,MAAM,GAAK,KAAK,GAAG,EAAE,QAAQ,KAAK,GAAM,CACtC,GAAI,GAAM,SAAS,cAAc,OACjC,EAAI,UAAY,EAEhB,KAAK,cAAc,qBAAqB,UAAY,EAAI,cAAc,oBAAoB,UAE1F,KAAK,cAAc,wCAAwC,iBAAiB,QAAS,GAAG,CACtF,KAAK,KAAK,WAGZ,KAAK,UAAU,OAAO,gBACtB,KAAK,SAIT,UAAU,EAAM,CACd,GAAM,GAAe,GAYrB,MAVA,MAAK,gBAAgB,MAAM,GAAQ,CACjC,GAAI,GAAQ,KAAK,gBAAgB,EAAQ,GAGzC,MAFA,GAAQ,GAAK,EAAa,KAAK,CAAC,MAAO,EAAO,IAAK,IAEhD,IAAa,QAAU,KAMzB,AAAC,EAAa,OAIjB,GAAa,KAAK,CAAC,EAAE,IAAY,EAAE,MAAQ,EAAE,OAEtC,EAAa,IAAI,GAAG,EAAE,KAAK,KAAK,OAL9B,GAQX,gBAAgB,EAAK,EAAO,CAC1B,GAAI,GAAS,GAAI,QAAO,EAAO,MAC/B,MAAQ,GAAI,MAAM,IAAW,IAAI,SAIrC,eAAe,OAAO,oBAAqB",
  "names": []
}
