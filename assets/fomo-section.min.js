(()=>{var u=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame,w=window.cancelAnimationFrame||window.mozCancelAnimationFrame,f=class extends HTMLElement{constructor(){super();this.cookieTime=!1,this.admin=!this.querySelector("template"),!this.admin&&this.firstLoad()}getTimes(){let t=new Date().getTime();this.times={cookie:t+this.dataset.cookie*1e3,firstShow:t+this.dataset.firstShow*1e3,loop:t+this.dataset.loop*1e3,show:t+this.dataset.show*1e3}}countdown(t,e){this.deadline=t,this.callback=e,this.startAnimationFrame=u(this.animationFrame.bind(this))}animationFrame(t,e){let i=new Date().getTime();this.deadline-i>=1e3?this.startAnimationFrame=u(this.animationFrame.bind(this)):(w(this.startAnimationFrame),this.callback())}async show(){this.closest(".js-fomo-container").insertAdjacentElement("afterbegin",this),this.checkForTemplate(),this.randomString(),this.randomProduct(),await this.randomNumber(),this.classList.add("active")}close(){this.classList.remove("active")}firstLoad(){this.getTimes(),this.countdown(this.times.firstShow,()=>{this.onShow()})}onShow(){this.getTimes(),this.show(),this.countdown(this.times.show,()=>{this.onClose()})}onClose(){this.getTimes(),this.close(),this.countdown(this.times.loop,()=>{this.onShow()})}checkForTemplate(){let t=this.querySelector("template");!t||(Array.from(t.content.children)?.forEach(e=>{t.insertAdjacentElement("beforebegin",e)}),t.remove())}getRandomNumber(t,e){return Math.floor(Math.random()*(e-t+1))+t}async randomNumber(){let t=this.querySelectorAll(".js-fomo-number");if(!t.length)return;let e=await theme.get(this.dataset.id),i=[];!this.admin&&!e&&(this.cookieTime=this.times.cookie),t.forEach(n=>{let m=+n.dataset.index,a=+n.dataset.randomMin,s=+n.dataset.randomMax,o=e?e?.find(d=>d.index==m):null,r=this.getRandomNumber(a,s);if(!this.admin&&o){let d=this.dataset.deviation,h=Math.round(o-o*d/100),l=Math.round(o+o*d/100);(h<a||isNaN(h))&&(h=a),(l>s||isNaN(l))&&(l=s),l==h&&(l=s,h=a),r=this.getRandomNumber(h,l)}n.innerHTML=r,i.push({index:m,value:r})}),theme.set(this.dataset.id,i,this.cookieTime)}randomString(){let t=this.querySelectorAll(".js-fomo-string");!t.length||t.forEach(e=>{let i=e.dataset.string.split(","),n=0,m=i.length-1,a=this.getRandomNumber(n,m);e.innerHTML=i[a]})}randomProduct(){let t=this.querySelectorAll(".js-fomo-product");!t.length||t.forEach(e=>{let i=JSON.parse(this.querySelector(`[data-random-product="${e.dataset.index}"]`).innerHTML),n=0,m=i.length-1,a=this.getRandomNumber(n,m),s=i.find(o=>o.index==a);if(!!s&&(e.innerHTML=s.title,e.href=s.url,this.querySelector("img"))){let o=this.querySelector("img"),r=document.createElement("img");r.src=s.image,r.className=o.className,o.replaceWith(r)}})}};customElements.define("fomo-item",f);register("fomo-section",{onLoad:function(){},onUnload:function(){this.container.querySelectorAll(".js-fomo")?.forEach(c=>{c.close()})},onSelect:function(){},onDeselect:function(){},onBlockSelect:function(c){c.target.show(),this.container.querySelectorAll(".js-fomo")?.forEach(t=>{t!=c.target&&t.close()})},onBlockDeselect:function(c){this.container.querySelectorAll(".js-fomo")?.forEach(t=>{t.close()})}});load("*");})();
